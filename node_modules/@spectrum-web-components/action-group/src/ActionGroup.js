"use strict";var h=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var n=(o,u,e,t)=>{for(var s=t>1?void 0:t?p(u,e):u,l=o.length-1,i;l>=0;l--)(i=o[l])&&(s=(t?i(u,e,s):i(s))||s);return t&&s&&h(u,e,s),s};import{html as b,SizedMixin as f,SpectrumElement as m}from"@spectrum-web-components/base";import{property as c}from"@spectrum-web-components/base/src/decorators.js";import{RovingTabindexController as v}from"@spectrum-web-components/reactive-controllers/src/RovingTabindex.js";import{MutationController as g}from"@lit-labs/observers/mutation_controller.js";import y from"./action-group.css.js";const d=[];export class ActionGroup extends f(m,{validSizes:["xs","s","m","l","xl"]}){constructor(){super();this._buttons=[];this._buttonSelector="sp-action-button";this.rovingTabindexController=new v(this,{focusInIndex:e=>{let t=-1;const s=e.findIndex((l,i)=>(!e[t]&&!l.disabled&&(t=i),l.selected&&!l.disabled));return e[s]?s:t},elements:()=>this.buttons,isFocusableElement:e=>!e.disabled});this.compact=!1;this.emphasized=!1;this.justified=!1;this.label="";this.quiet=!1;this.vertical=!1;this._selected=d;this.manageButtons=()=>{const e=this.shadowRoot.querySelector("slot");if(!e)return;const s=e.assignedElements({flatten:!0}).reduce((i,r)=>{if(r.matches(this._buttonSelector))i.push(r);else{const a=Array.from(r.querySelectorAll(`:scope > ${this._buttonSelector}`));i.push(...a)}return i},[]);this.buttons=s;const l=[];this.buttons.forEach(i=>{i.selected&&l.push(i.value)}),this.setSelected(this.selected.concat(l)),this.manageChildren(),this.manageSelects()};new g(this,{config:{childList:!0,subtree:!0},callback:()=>{this.manageButtons()}})}static get styles(){return[y]}set buttons(e){e!==this.buttons&&(this._buttons=e,this.rovingTabindexController.clearElementCache())}get buttons(){return this._buttons}set selected(e){this.requestUpdate("selected",this._selected),this._selected=e,this.updateComplete.then(()=>{this.applySelects(),this.manageChildren()})}get selected(){return this._selected}dispatchChange(e){this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0,cancelable:!0}))||(this.setSelected(e),this.buttons.map(s=>{s.selected=this.selected.includes(s.value)}))}setSelected(e,t){if(e===this.selected)return;const s=this.selected;this.requestUpdate("selected",s),this._selected=e,t&&this.dispatchChange(s)}focus(e){this.rovingTabindexController.focus(e)}deselectSelectedButtons(){[...this.querySelectorAll("[selected]")].forEach(t=>{t.selected=!1,t.tabIndex=-1,t.setAttribute("aria-checked","false")})}handleClick(e){const t=e.target;if(typeof t.value!="undefined")switch(this.selects){case"single":{this.deselectSelectedButtons(),t.selected=!0,t.tabIndex=0,t.setAttribute("aria-checked","true"),this.setSelected([t.value],!0),t.focus();break}case"multiple":{const s=[...this.selected];t.selected=!t.selected,t.setAttribute("aria-checked",t.selected?"true":"false"),t.selected?s.push(t.value):s.splice(this.selected.indexOf(t.value),1),this.setSelected(s,!0),this.buttons.forEach(l=>{l.tabIndex=-1}),t.tabIndex=0;break}default:break}}async applySelects(){await this.manageSelects(!0)}async manageSelects(e){if(!this.buttons.length)return;const t=this.buttons;switch(this.selects){case"single":{this.setAttribute("role","radiogroup");const s=[],l=t.map(async r=>{await r.updateComplete,r.setAttribute("role","radio"),r.setAttribute("aria-checked",r.selected?"true":"false"),r.selected&&s.push(r)});if(e)break;await Promise.all(l);const i=s.map(r=>r.value);this.setSelected(i||d);break}case"multiple":{this.setAttribute("role","group");const s=[],l=[],i=t.map(async a=>{await a.updateComplete,a.setAttribute("role","checkbox"),a.setAttribute("aria-checked",a.selected?"true":"false"),a.selected&&(s.push(a.value),l.push(a))});if(e)break;await Promise.all(i);const r=s.length?s:d;this.setSelected(r);break}default:if(this.selected.length){const s=[],l=t.map(async i=>{await i.updateComplete,i.setAttribute("aria-checked",i.selected?"true":"false"),i.setAttribute("role","button"),i.selected&&s.push(i)});if(e)break;await Promise.all(l),this.setSelected(s.map(i=>i.value))}else{this.buttons.forEach(s=>{s.setAttribute("role","button")}),this.removeAttribute("role");break}}}render(){return b`
            <slot role="presentation" @slotchange=${this.manageButtons}></slot>
        `}firstUpdated(e){super.firstUpdated(e),this.addEventListener("click",this.handleClick)}updated(e){super.updated(e),e.has("selects")&&(this.manageSelects(),this.manageChildren()),(e.has("quiet")&&this.quiet||e.has("emphasized")&&this.emphasized||e.has("size")&&this.size)&&this.manageChildren(),e.has("label")&&(this.label||typeof e.get("label")!="undefined")&&(this.label.length?this.setAttribute("aria-label",this.label):this.removeAttribute("aria-label"))}manageChildren(){this.buttons.forEach(e=>{e.quiet=this.quiet,e.emphasized=this.emphasized,e.selected=this.selected.includes(e.value),e.size=this.size})}}n([c({type:Boolean,reflect:!0})],ActionGroup.prototype,"compact",2),n([c({type:Boolean,reflect:!0})],ActionGroup.prototype,"emphasized",2),n([c({type:Boolean,reflect:!0})],ActionGroup.prototype,"justified",2),n([c({type:String})],ActionGroup.prototype,"label",2),n([c({type:Boolean,reflect:!0})],ActionGroup.prototype,"quiet",2),n([c({type:String})],ActionGroup.prototype,"selects",2),n([c({type:Boolean,reflect:!0})],ActionGroup.prototype,"vertical",2),n([c({type:Array})],ActionGroup.prototype,"selected",1);
//# sourceMappingURL=ActionGroup.js.map
