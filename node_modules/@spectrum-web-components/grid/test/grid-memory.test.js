"use strict";
import { expect, fixture, nextFrame } from "@open-wc/testing";
import { html, render } from "@spectrum-web-components/base";
import { Default } from "../stories/grid.stories";
async function usedHeapMB() {
  const memorySample = performance.measureUserAgentSpecificMemory();
  return (await memorySample).bytes / (1024 * 1024);
}
describe("Grid memory usage", () => {
  it("releases references on disconnect", async function() {
    if (!window.gc || !("measureUserAgentSpecificMemory" in performance))
      this.skip();
    this.timeout(1e4);
    const iterations = 50;
    let active = false;
    const el = await fixture(
      html`
                <div></div>
            `
    );
    async function toggle(forced = void 0) {
      active = forced != null ? forced : !active;
      render(active ? Default() : html``, el);
      await nextFrame();
      await nextFrame();
    }
    for (let i = 0; i < 5; i++) {
      await toggle();
    }
    await toggle(false);
    const beforeMB = await usedHeapMB();
    for (let i = 0; i < iterations; i++) {
      await toggle();
    }
    await toggle(false);
    const afterMB = await usedHeapMB();
    expect(
      afterMB - beforeMB,
      `before: ${beforeMB}, after: ${afterMB}`
    ).to.be.lt(0);
  });
});
//# sourceMappingURL=grid-memory.test.js.map
