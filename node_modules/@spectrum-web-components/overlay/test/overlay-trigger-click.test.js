"use strict";
import {
  elementUpdated,
  expect,
  fixture,
  html,
  oneEvent,
  waitUntil
} from "@open-wc/testing";
import "@spectrum-web-components/popover/sp-popover.js";
import "@spectrum-web-components/action-button/sp-action-button.js";
import "@spectrum-web-components/icons-workflow/icons/sp-icon-magnify.js";
import "@spectrum-web-components/popover/sp-popover.js";
import "@spectrum-web-components/overlay/overlay-trigger.js";
import { spy } from "sinon";
describe("Overlay Trigger - Click", () => {
  it("displays `click` declaratively", async () => {
    const openedSpy = spy();
    const closedSpy = spy();
    const el = await fixture(
      (() => html`
                <overlay-trigger
                    placement="right-start"
                    open="click"
                    @sp-opened=${() => openedSpy()}
                    @sp-closed=${() => closedSpy()}
                >
                    <sp-action-button slot="trigger">
                        <sp-icon-magnify slot="icon"></sp-icon-magnify>
                    </sp-action-button>
                    <sp-popover slot="click-content" tip></sp-popover>
                </overlay-trigger>
            `)()
    );
    await elementUpdated(el);
    await waitUntil(
      () => openedSpy.calledOnce,
      "click content projected to overlay",
      { timeout: 2e3 }
    );
    el.removeAttribute("open");
    await elementUpdated(el);
    await waitUntil(() => closedSpy.calledOnce, "click content returned", {
      timeout: 2e3
    });
  });
  describe("closes on scroll", () => {
    afterEach(() => {
      if (document.scrollingElement) {
        document.scrollingElement.scrollTop = 0;
      }
    });
    ["click", "replace", "inline"].map(
      (interaction) => {
        it(`closes "${interaction}" overlay on scroll`, async () => {
          const el = await fixture(html`
                        <overlay-trigger
                            placement="right-start"
                            type=${interaction}
                        >
                            <sp-action-button
                                slot="trigger"
                                style="margin: 50vh 0 100vh;"
                            >
                                <sp-icon-magnify slot="icon"></sp-icon-magnify>
                            </sp-action-button>
                            <sp-popover slot="click-content" tip></sp-popover>
                        </overlay-trigger>
                    `);
          expect(el.open).to.be.undefined;
          await elementUpdated(el);
          const opened = oneEvent(el, "sp-opened");
          el.open = "click";
          await opened;
          expect(el.open).to.equal("click");
          const closed = oneEvent(el, "sp-closed");
          if (document.scrollingElement) {
            document.scrollingElement.scrollTop = 100;
          }
          await closed;
          expect(el.open).to.be.null;
        });
      }
    );
  });
  it("opens a second time", async () => {
    const openedSpy = spy();
    const closedSpy = spy();
    const el = await fixture(html`
            <overlay-trigger
                placement="right-start"
                type="modal"
                open="click"
                @sp-opened=${() => openedSpy()}
                @sp-closed=${() => closedSpy()}
            >
                <sp-action-button slot="trigger">
                    <sp-icon-magnify slot="icon"></sp-icon-magnify>
                </sp-action-button>
                <sp-popover slot="click-content" tip></sp-popover>
            </overlay-trigger>
        `);
    await elementUpdated(el);
    const trigger = el.querySelector("[slot=trigger]");
    await waitUntil(
      () => openedSpy.calledOnce,
      "click content projected to overlay",
      { timeout: 2e3 }
    );
    expect(el.open).to.equal("click");
    el.removeAttribute("open");
    await elementUpdated(el);
    await waitUntil(() => closedSpy.calledOnce, "click content returned", {
      timeout: 2e3
    });
    expect(el.open).to.be.null;
    trigger.click();
    await waitUntil(
      () => openedSpy.callCount === 2,
      "click content projected to overlay, again",
      { timeout: 2e3 }
    );
    expect(el.open).to.equal("click");
  });
});
//# sourceMappingURL=overlay-trigger-click.test.js.map
