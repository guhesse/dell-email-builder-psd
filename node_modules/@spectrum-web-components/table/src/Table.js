"use strict";var u=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var a=(h,c,e,l)=>{for(var t=l>1?void 0:l?p(c,e):c,s=h.length-1,i;s>=0;s--)(i=h[s])&&(t=(l?i(c,e,t):i(t))||t);return l&&t&&u(c,e,t),t};import{html as r,render as m,SizedMixin as f,SpectrumElement as C}from"@spectrum-web-components/base";import"../sp-table-row.js";import"../sp-table-checkbox-cell.js";import"../sp-table-body.js";import{property as d}from"@spectrum-web-components/base/src/decorators.js";import k from"./table.css.js";import{virtualize as g,virtualizerRef as v}from"@lit-labs/virtualizer/virtualize.js";export var RowType=(e=>(e[e.ITEM=0]="ITEM",e[e.INFORMATION=1]="INFORMATION",e))(RowType||{});const n=class extends Event{constructor(e){super(n.eventName,{bubbles:!0});this.first=e.first,this.last=e.last}};export let RangeChangedEvent=n;RangeChangedEvent.eventName="rangeChanged";export class Table extends f(C,{validSizes:["s","m"],defaultSize:"m"}){constructor(){super(...arguments);this._renderItem=()=>r``;this.role="grid";this.selected=[];this.selectedSet=new Set;this.items=[];this.itemValue=(e,l)=>`${l}`;this.scroller=!1}static get styles(){return[k]}get renderItem(){return this._renderItem}set renderItem(e){this._renderItem=(l,t)=>{const s=this.itemValue(l,t),i=this.selected.includes(s),b=this.selects&&(l==null?void 0:l._$rowType$)!==1;return r`
                <sp-table-row
                    value=${s}
                    aria-rowindex=${t+1}
                    ?selected=${i}
                >
                    ${b?r`
                              <sp-table-checkbox-cell
                                  ?checked=${i}
                              ></sp-table-checkbox-cell>
                          `:r``}
                    ${e(l,t)}
                </sp-table-row>
            `}}get tableHead(){return this.querySelector("sp-table-head")}get tableRows(){return this.isVirtualized?[]:[...this.querySelectorAll("sp-table-row")]}get isVirtualized(){return!!this.items.length}focus(){const e=this.querySelector("sp-table-head-cell[sortable]");e&&e.focus()}selectAllRows(){this.isVirtualized?this.items.forEach((e,l)=>{e._$rowType$!==1&&this.selectedSet.add(this.itemValue(e,l))}):this.tableRows.forEach(e=>{e.selected=!0,this.selectedSet.add(e.value)}),this.selected=[...this.selectedSet],this.tableHeadCheckboxCell&&(this.tableHeadCheckboxCell.checked=!0,this.tableHeadCheckboxCell.indeterminate=!1)}deselectAllRows(){this.selectedSet.clear(),this.selected=[],this.isVirtualized||[...this.querySelectorAll("[selected]")].forEach(l=>{l.selected=!1}),this.tableHeadCheckboxCell&&(this.tableHeadCheckboxCell.checked=!1,this.tableHeadCheckboxCell.indeterminate=!1)}manageSelects(){const e=this.querySelectorAll("sp-table-checkbox-cell"),l=document.createElement("sp-table-checkbox-cell");if(this.selects){let t=!1;this.isVirtualized?t=this.selected.length>0&&this.selected.length===this.items.length:(this.tableRows.forEach(s=>{if(s.selected=this.selectedSet.has(s.value),!s.querySelector(":scope > sp-table-checkbox-cell")){const i=l.cloneNode();s.insertAdjacentElement("afterbegin",i),l.checked=s.selected}}),t=this.selected.length===this.tableRows.length),this.tableHeadCheckboxCell||(this.tableHeadCheckboxCell=document.createElement("sp-table-checkbox-cell"),this.tableHead.insertAdjacentElement("afterbegin",this.tableHeadCheckboxCell)),this.manageHeadCheckbox(t)}else e.forEach(t=>{t.remove()}),delete this.tableHeadCheckboxCell}validateSelected(){const e=new Set;this.isVirtualized?this.items.forEach((t,s)=>{const i=this.itemValue(t,s);e.add(i)}):this.tableRows.forEach(t=>{e.add(t.value)});const l=this.selected.length;this.selected=this.selected.filter(t=>e.has(t)),l!==this.selected.length&&this.dispatchEvent(new Event("change",{cancelable:!0,bubbles:!0,composed:!0})),this.selectedSet=new Set(this.selected)}manageSelected(){this.validateSelected(),!this.isVirtualized&&(this.tableRows.forEach(e=>{e.selected=this.selectedSet.has(e.value)}),this.tableHeadCheckboxCell&&(this.tableHeadCheckboxCell.checked=this.selected.length===this.tableRows.length))}manageCheckboxes(){var e;if(this.selects){this.tableHeadCheckboxCell=document.createElement("sp-table-checkbox-cell");const l=this.selected.length===this.tableRows.length;this.manageHeadCheckbox(l),this.tableHead.insertAdjacentElement("afterbegin",this.tableHeadCheckboxCell),this.tableRows.forEach(t=>{const s=document.createElement("sp-table-checkbox-cell");t.insertAdjacentElement("afterbegin",s),t.selected=this.selectedSet.has(t.value),s.checked=t.selected})}else(e=this.tableHead.querySelector("sp-table-checkbox-cell"))==null||e.remove(),this.tableRows.forEach(l=>{var t;(t=l.checkboxCells[0])==null||t.remove(),this.selected.length&&(l.selected=this.selectedSet.has(l.value))})}manageHeadCheckbox(e){!this.tableHeadCheckboxCell||(this.tableHeadCheckboxCell.selectsSingle=this.selects==="single",this.tableHeadCheckboxCell.checked=e,this.tableHeadCheckboxCell.indeterminate=this.selected.length>0&&!e)}handleChange(e){e.stopPropagation();const l=new Set(this.selectedSet),t=[...this.selected],{target:s}=e,{parentElement:i}=s;if(i.value)switch(this.selects){case"single":{this.deselectAllRows(),i.selected&&(this.selectedSet.add(i.value),this.selected=[...this.selectedSet]);break}case"multiple":{i.selected?this.selectedSet.add(i.value):this.selectedSet.delete(i.value),this.selected=[...this.selectedSet];const o=this.selected.length===this.tableRows.length;if(!this.tableHeadCheckboxCell)return;this.tableHeadCheckboxCell.checked=o,this.tableHeadCheckboxCell.indeterminate=this.selected.length>0&&!o;break}default:break}else{const{checkbox:o}=s;o.checked||o.indeterminate?this.selectAllRows():this.deselectAllRows()}this.dispatchEvent(new Event("change",{cancelable:!0,bubbles:!0,composed:!0}))||(e.preventDefault(),this.selectedSet=l,this.selected=t)}scrollToIndex(e){if(e&&!!this.tableBody){const t=this.tableBody[v].element(e);t&&t.scrollIntoView()}}render(){return r`
            <slot @change=${this.handleChange}></slot>
        `}willUpdate(e){this.hasUpdated||(this.validateSelected(),this.manageCheckboxes()),e.has("selects")&&this.manageSelects(),e.has("selected")&&this.hasUpdated&&this.manageSelected()}updated(){this.items.length&&this.renderVirtualizedItems()}renderVirtualizedItems(){if(!this.isConnected)return;this.tableBody||(this.tableBody=this.querySelector("sp-table-body"),this.tableBody||(this.tableBody=document.createElement("sp-table-body"),this.append(this.tableBody)),this.tableBody.addEventListener("rangeChanged",l=>{this.dispatchEvent(new RangeChangedEvent({first:l.first,last:l.last}))}));const e={items:this.items,renderItem:this.renderItem,scroller:this.scroller};m(r`
                ${g(e)}
            `,this.tableBody)}disconnectedCallback(){super.disconnectedCallback()}}a([d({reflect:!0})],Table.prototype,"role",2),a([d({type:String,reflect:!0})],Table.prototype,"selects",2),a([d({type:Array})],Table.prototype,"selected",2),a([d({type:Array})],Table.prototype,"items",2),a([d({type:Object})],Table.prototype,"itemValue",2),a([d({type:Boolean,reflect:!0})],Table.prototype,"scroller",2);
//# sourceMappingURL=Table.js.map
